<!doctype html><html lang=en-us><head><meta name=robots content="noai, noimageai"><meta name=viewport content="width=device-width"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=7"><link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.png type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png><title>How to parse an array with differing array types &ndash;
dev.Enthys</title><link href=/symbols-nerd-font/symbols-nerd-font.css rel=stylesheet integrity="sha512-lydow8GLOLlYNOtHlksNCmGWWCBsbIEtikXpHzfWqx78HLlyQZHOzyLwPpKol4Th6aCwLUXOfODVYgwrd3nwKQ=="><link href=/jetbrains-mono/jetbrains-mono.css rel=stylesheet integrity="sha512-tJxlgL6v1Y7kFf+qB8SloaAMKnOAw6WouknxXtIjkBux9Y/9aX81EUWOJO8c/3l98DmjG8brr4to7zaez606Fg=="><link type=text/css rel=stylesheet href=https://dev.enthys.com/css/styles.6e90eb16e20354150a7292d54ef2ecc5c8a428541fa4fe7cb6d0b88c698c620201c975ed3f24c1d1d51fac2745f6f7e62611a776476a4bfa24a38b584a6336bb.css integrity="sha512-bpDrFuIDVBUKcpLVTvLsxcikKFQfpP58ttC4jGmMYgIByXXtPyTB0dUfrCdF9vfmJhGndkdqS/oko4tYSmM2uw=="><meta name=author content="Asen Mihaylov"><meta name=keywords content="golang"><meta name=description content="y which contains dynamic types Parsing an array which has a single type within it is easy, but what about arrays which have dynamic values? Parsing such arrays could be tricky but in this post we will explore how to do just that. Lets imagine we are making a game and we have an array or nearby targets, each one having different attributes based on the type of nearby target.
Our array { &amp;#34;targets&amp;#34;: [ {&amp;#34;type&amp;#34;: &amp;#34;player&amp;#34;, &amp;#34;attributes&amp;#34;: {&amp;#34;level&amp;#34;: 10, &amp;#34;name&amp;#34;: &amp;#34;Duke&amp;#34;, &amp;#34;class&amp;#34;: &amp;#34;Warrior&amp;#34;}}, {&amp;#34;type&amp;#34;: &amp;#34;enemy&amp;#34;, &amp;#34;attributes&amp;#34;: {&amp;#34;level&amp;#34;: 11, &amp;#34;name&amp;#34;: &amp;#34;Goblin&amp;#34;, &amp;#34;personality&amp;#34;: &amp;#34;aggressive&amp;#34;}}, {&amp;#34;type&amp;#34;: &amp;#34;object&amp;#34;, &amp;#34;attributes&amp;#34;: {&amp;#34;name&amp;#34;: &amp;#34;Tree&amp;#34;, &amp;#34;interactable&amp;#34;: false }} ] } In the JSON above we have an array which has 3 items in it."><meta property="og:site_name" content="dev.Enthys"><meta property="og:title" content="How to parse an array with differing array types"><meta property="og:type" content="article"><meta property="article:author" content="Asen Mihaylov"><meta property="article:published_time" content="0001-01-01T00:00:00Z+0000"><meta property="article:tag" content="golang"><meta property="og:url" content="https://dev.enthys.com/posts/golang_json_dynamic_array_types/"><meta property="og:image" content="https://dev.enthys.com/img/icon.svg"><meta property="og:description" content="How to parse an array which contains dynamic types Parsing an array which has a single type within it is easy, but what about arrays which have dynamic values? "><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="dev.enthys.com"><meta property="twitter:url" content="https://dev.enthys.com/posts/golang_json_dynamic_array_types/"><meta name=twitter:title content="How to parse an array with differing array types"><meta name=twitter:image content="https://dev.enthys.com/img/icon.svg"><meta name=twitter:description content="How to parse an array which contains dynamic types Parsing an array which has a single type within it is easy, but what about arrays which have dynamic values? "><link rel=manifest href=/manifest/index.json></head><body><div id=baseContainer><header><div class=titleAndSearchContainer><div id=titleContainer><a class=unstyledLink href=/><img src=/logo.png alt=Logo></a><div class=rightOfLogo><div class=titleAndHamburger><h1><a class=unstyledLink href=/>dev.Enthys</a></h1></div><div id=wide_nav><nav><ul id=main-nav><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/projects/>Projects</a></li><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/search/>Search</a></li></ul></nav></div></div></div><div class=search><input id=searchbar type=text placeholder=Search>
<span class=nerdlink onclick=newSearch()>&#xf002;</span></div><script>function newSearch(){let e=searchbar.value.trim();if(!e)return;location.href=`/search/?q=${e}`}searchbar.onkeyup=e=>{e.keyCode==13&&newSearch()}</script></div><div id=links><a rel=noreferrer target=_blank class=nerdlink href=/index.xml>&#xf09e;
<span>RSS</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://github.com/Enthys>&#xf09b;
<span>Github</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://www.linkedin.com/in/asen-mihaylov/>&#xf0e1;
<span>LinkedIn</span></a></div><div id=sidebar_nav><nav><ul id=main-nav><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/projects/>Projects</a></li><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/search/>Search</a></li></ul></nav></div></header><div id=contentContainer><div id=content><main><article class="card single"><h1>How to parse an array with differing array types</h1><p class=date><span title=Date>ï—¬</span>
0001-01-01</p><div><h1 id=how-to-parse-an-array-which-contains-dynamic-types>How to parse an array which contains dynamic types</h1><p>Parsing an array which has a single type within it is easy, but what about arrays which have dynamic values? Parsing such arrays could be tricky but in this post we will explore how to do just that. Lets imagine we are making a game and we have an array or nearby targets, each one having different attributes based on the type of nearby target.</p><h2 id=our-array>Our array</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;targets&#34;</span>: [
</span></span><span style=display:flex><span>        {<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;player&#34;</span>, <span style=color:#f92672>&#34;attributes&#34;</span>: {<span style=color:#f92672>&#34;level&#34;</span>: <span style=color:#ae81ff>10</span>, <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Duke&#34;</span>, <span style=color:#f92672>&#34;class&#34;</span>: <span style=color:#e6db74>&#34;Warrior&#34;</span>}},
</span></span><span style=display:flex><span>        {<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;enemy&#34;</span>, <span style=color:#f92672>&#34;attributes&#34;</span>: {<span style=color:#f92672>&#34;level&#34;</span>: <span style=color:#ae81ff>11</span>, <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Goblin&#34;</span>, <span style=color:#f92672>&#34;personality&#34;</span>: <span style=color:#e6db74>&#34;aggressive&#34;</span>}},
</span></span><span style=display:flex><span>        {<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;object&#34;</span>, <span style=color:#f92672>&#34;attributes&#34;</span>: {<span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Tree&#34;</span>, <span style=color:#f92672>&#34;interactable&#34;</span>: <span style=color:#66d9ef>false</span> }}
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the JSON above we have an array which has 3 items in it. Each item represents a different kind of targets which our player can do things with.</p><h2 id=parsing-the-array>Parsing the array</h2><h3 id=types>Types</h3><p>Lets first create our classes</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Player</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Level</span> <span style=color:#66d9ef>int</span> <span style=color:#e6db74>`json:&#34;level&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Class</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;class&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Enemy</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Level</span> <span style=color:#66d9ef>int</span> <span style=color:#e6db74>`json:&#34;level&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Personality</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;personality&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Object</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Interactable</span> <span style=color:#66d9ef>bool</span> <span style=color:#e6db74>`json:&#34;interactable&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Each of our classes now can be used to parse their own individual JSON string, but when they are all in an array it won&rsquo;t really work. Lets make our lives a bit easier and make an interface which all of our types will implement.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Named</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetName</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#a6e22e>Player</span>) <span style=color:#a6e22e>GetName</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>Enemy</span>) <span style=color:#a6e22e>GetName</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>Name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>o</span> <span style=color:#a6e22e>Object</span>) <span style=color:#a6e22e>GetName</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>Name</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lets-start-parsing>Lets start parsing</h2><p>Now that we have an interface which all of our types implement. We can create an array which uses that interface. But still how do we parse the values? The way we can parse the json is a combination of anonymous structs and <code>json.RawMessage</code>. Lets start Unmarshaling</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>j</span> <span style=color:#f92672>:=</span> []byte(<span style=color:#e6db74>`{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;targets&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {&#34;type&#34;: &#34;player&#34;, &#34;attributes&#34;: {&#34;level&#34;: 10, &#34;name&#34;: &#34;Duke&#34;, &#34;class&#34;: &#34;Warrior&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {&#34;type&#34;: &#34;enemy&#34;, &#34;attributes&#34;: {&#34;level&#34;: 11, &#34;name&#34;: &#34;Goblin&#34;, &#34;personality&#34;: &#34;aggressive&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            {&#34;type&#34;: &#34;object&#34;, &#34;attributes&#34;: {&#34;name&#34;: &#34;Tree&#34;, &#34;interactable&#34;: false }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }`</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nameableTargets</span> <span style=color:#66d9ef>struct</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Targets</span> []<span style=color:#a6e22e>Named</span> <span style=color:#75715e>// Our end goal is to fill this array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>targets</span> <span style=color:#66d9ef>struct</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Targets</span> []<span style=color:#66d9ef>struct</span>{
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Depending on the value of this field we will be determining what kind of struct we should initiate
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>Type</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;type&#34;`</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// By using RawMessage we can delay the parsing of the values in order to determine what kind of type to use
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>Arguments</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>RawMessage</span> <span style=color:#e6db74>`json:&#34;attributes&#34;`</span> 
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Parse the json into our temporary collection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>j</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>targets</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Fill out the result array with the correct types
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>t</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>targets</span>.<span style=color:#a6e22e>Targets</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Type</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;player&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>player</span> <span style=color:#a6e22e>Player</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>player</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>nameableTargets</span> = append(<span style=color:#a6e22e>nameableTargets</span>, <span style=color:#a6e22e>player</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;enemy&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>enemy</span> <span style=color:#a6e22e>Enemy</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>enemy</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>nameableTargets</span> = append(<span style=color:#a6e22e>nameableTargets</span>, <span style=color:#a6e22e>enemy</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;object&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>obj</span> <span style=color:#a6e22e>Object</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>object</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>nameableTargets</span> = append(<span style=color:#a6e22e>nameableTargets</span>, <span style=color:#a6e22e>obj</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%+v&#34;</span>, <span style=color:#a6e22e>nameableTargets</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And that is the way we can dynamically determine what kind of object should be created and saved to the array.</p></div></article><p class=articleTagsContainer><span>ï€«</span>
<strong>Tags:</strong>
<a class=buttonTag href=/tags/golang/>#golang</a></p></main><footer><hr><p><small>2024 &copy;</small></p><p><small><a href=https://gitlab.com/gabmus/hugo-ficurinia>Ficurinia theme</a> for <a href=https://gohugo.io>Hugo</a> by <a href=https://gabmus.org>Gabriele Musco</a>. Licensed under <a href=https://www.gnu.org/licenses/agpl-3.0.html>GNU AGPLv3</a>.</small></p></footer></div></div></div></body></html>